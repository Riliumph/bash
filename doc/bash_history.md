# bash_historyによるコマンド実行履歴

## historyコマンド

`bash`では↑キーを使ってコマンドの実行履歴を遡ることができる。  
この履歴管理機能は`history`コマンドを使って実現されている。

このhistoryコマンドは、環境変数`HISTSIZE`分のバッファを確保する。  
コマンド実行後、その成否に関わらずバッファにキューイングし続ける。  
そして、記録タイミングが来た時に`HISTFILE`へフラッシュされる。

> `HISTSIZE`のデフォルトは、環境によって異なるものの1000程度の模様。

## オプション

主に使われるオプションは以下

- -a: バッファの内容を`HISTFILE`へフラッシュする
- -c: バッファの内容を削除する
- -r: `HISTFILE`からバッファへロードする

例えば、以下のような組み合わせが考えられる。

- -cr: バッファを破棄し、既存の履歴をリロードする
- -acr: バッファをフラッシュし、他のターミナル・ユーザーのフラッシュした記録もロードする

## bash_history/HISTFILEとは

`.bash_history`は、環境変数`HISTFILE`で管理されるbash上で実行したコマンドの保管機能・ファイルである。  
改竄が可能であることから証跡ログとして完璧ではないものの、お手軽にコマンド実行ログとして利用できる。

## 記録されるタイミング

コマンドの実行履歴直後に履歴を書き込むわけではない。  
コマンドを実行すると、そのコマンドの内容が履歴バッファにキューイングされる。  
端末のセッション終了時に、バッファの内容が`HISTFILE`へフラッシュされる。

### コマンド実行事に書き出したい場合は？

プロンプト表示前に実行される環境変数`PROMPT_COMMAND`を利用する。  
